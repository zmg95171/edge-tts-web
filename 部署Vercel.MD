éƒ¨ç½²Vercel


å®Œæ•´çš„ Vercel éƒ¨ç½²æ–¹æ¡ˆ,é‡ç‚¹è§£å†³ API è®¿é—®é—®é¢˜ã€‚

## ğŸ¯ Vercel éƒ¨ç½²å®Œæ•´æ–¹æ¡ˆ

### æ–¹æ¡ˆä¸€:ä½¿ç”¨ Vercel Serverless Functions ä½œä¸º API ä»£ç†(æ¨èâ­â­â­â­â­)

è¿™ä¸ªæ–¹æ¡ˆæœ€ç¨³å®š,å¯ä»¥å®Œå…¨è§£å†³ CORS é—®é¢˜,å¹¶ä¸”ä¿æŠ¤ API å¯†é’¥ã€‚
ç°åœ¨æˆ‘ä¸ºä½ åˆ›å»ºå®Œæ•´çš„ Vercel éƒ¨ç½²é…ç½®æ–‡ä»¶ã€‚æˆ‘ä¼šåœ¨ ask æ¨¡å¼ä¸‹æä¾›æ‰€æœ‰éœ€è¦çš„é…ç½®å’Œä»£ç ,ä½ å¯ä»¥å¤åˆ¶åº”ç”¨è¿™äº›æ–‡ä»¶ã€‚

## ğŸ“‹ éƒ¨ç½²åˆ° Vercel çš„å®Œæ•´æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°
æˆ‘ä»¬å°†ä½¿ç”¨ **Vercel Serverless Functions** ä½œä¸º API ä»£ç†,è¿™æ ·å¯ä»¥:
- âœ… å®Œå…¨è§£å†³ CORS è·¨åŸŸé—®é¢˜
- âœ… ä¿æŠ¤ API å¯†é’¥å®‰å…¨
- âœ… ä¿æŒå¼€å‘ç¯å¢ƒé…ç½®ä¸å˜
- âœ… äº«å— Vercel çš„å…¨çƒ CDN åŠ é€Ÿ

---

## ğŸ“ éœ€è¦åˆ›å»º/ä¿®æ”¹çš„æ–‡ä»¶

### 1ï¸âƒ£ åˆ›å»º `vercel.json` é…ç½®æ–‡ä»¶

è¿™ä¸ªæ–‡ä»¶é…ç½® Vercel çš„éƒ¨ç½²è§„åˆ™å’Œé‡å†™è§„åˆ™:

```json
{
  "rewrites": [
    {
      "source": "/api/tts/:path*",
      "destination": "/api/tts-proxy"
    },
    {
      "source": "/api/whisper/:path*",
      "destination": "/api/whisper-proxy"
    }
  ],
  "functions": {
    "api/**/*.ts": {
      "memory": 1024,
      "maxDuration": 30
    }
  },
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Access-Control-Allow-Origin",
          "value": "*"
        },
        {
          "key": "Access-Control-Allow-Methods",
          "value": "GET, POST, OPTIONS"
        },
        {
          "key": "Access-Control-Allow-Headers",
          "value": "Content-Type, Authorization"
        }
      ]
    }
  ]
}
```

---

### 2ï¸âƒ£ åˆ›å»º `api/tts-proxy.ts` - TTS API ä»£ç†å‡½æ•°

```typescript
import { NextRequest, NextResponse } from 'next/server';

const TTS_SERVICE_URL = 'https://tts.2068.online';

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 200,
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type, Authorization',
    },
  });
}

export async function GET(request: NextRequest) {
  try {
    const { pathname, searchParams } = new URL(request.url);
    const path = pathname.replace('/api/tts-proxy', '');
    
    const targetUrl = `${TTS_SERVICE_URL}/api/tts${path}?${searchParams}`;
    
    const response = await fetch(targetUrl, {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    });

    const data = await response.json();
    
    return NextResponse.json(data, {
      status: response.status,
      headers: {
        'Access-Control-Allow-Origin': '*',
      },
    });
  } catch (error) {
    console.error('TTS Proxy Error:', error);
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { 
        status: 500,
        headers: {
          'Access-Control-Allow-Origin': '*',
        },
      }
    );
  }
}

export async function POST(request: NextRequest) {
  try {
    const { pathname } = new URL(request.url);
    const path = pathname.replace('/api/tts-proxy', '');
    
    const body = await request.json();
    
    const targetUrl = `${TTS_SERVICE_URL}/api/tts${path}`;
    
    const response = await fetch(targetUrl, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(body),
    });

    // å¤„ç†éŸ³é¢‘æµå“åº”
    const contentType = response.headers.get('content-type');
    
    if (contentType && contentType.includes('audio')) {
      const audioBuffer = await response.arrayBuffer();
      
      return new NextResponse(audioBuffer, {
        status: response.status,
        headers: {
          'Content-Type': contentType,
          'Access-Control-Allow-Origin': '*',
        },
      });
    }
    
    // JSON å“åº”
    const data = await response.json();
    
    return NextResponse.json(data, {
      status: response.status,
      headers: {
        'Access-Control-Allow-Origin': '*',
      },
    });
  } catch (error) {
    console.error('TTS Proxy Error:', error);
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { 
        status: 500,
        headers: {
          'Access-Control-Allow-Origin': '*',
        },
      }
    );
  }
}
```

---

### 3ï¸âƒ£ åˆ›å»º `api/whisper-proxy.ts` - Whisper API ä»£ç†å‡½æ•°

```typescript
import { NextRequest, NextResponse } from 'next/server';

const WHISPER_SERVICE_URL = 'https://Whisper.2068.online';

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 200,
    headers: {
      'Access-Control-Allow-Origin': '*',
      'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
      'Access-Control-Allow-Headers': 'Content-Type, Authorization',
    },
  });
}

export async function POST(request: NextRequest) {
  try {
    const { pathname } = new URL(request.url);
    const path = pathname.replace('/api/whisper-proxy', '');
    
    const formData = await request.formData();
    
    const targetUrl = `${WHISPER_SERVICE_URL}/api/whisper${path}`;
    
    const response = await fetch(targetUrl, {
      method: 'POST',
      body: formData,
    });

    const data = await response.json();
    
    return NextResponse.json(data, {
      status: response.status,
      headers: {
        'Access-Control-Allow-Origin': '*',
      },
    });
  } catch (error) {
    console.error('Whisper Proxy Error:', error);
    return NextResponse.json(
      { error: 'Internal Server Error' },
      { 
        status: 500,
        headers: {
          'Access-Control-Allow-Origin': '*',
        },
      }
    );
  }
}
```

---

### 4ï¸âƒ£ åˆ›å»º `.env.production` ç”Ÿäº§ç¯å¢ƒå˜é‡

```bash
# TTS Service URL (å¯é€‰,å¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼)
VITE_TTS_API_URL=https://tts.2068.online

# Whisper Service URL (å¯é€‰,å¦‚æœä¸é…ç½®åˆ™ä½¿ç”¨é»˜è®¤å€¼)
VITE_WHISPER_API_URL=https://Whisper.2068.online

# Gemini API Key (å¿…éœ€)
GEMINI_API_KEY=your_gemini_api_key_here
```

---

### 5ï¸âƒ£ ä¿®æ”¹ `vite.config.ts` - ä¼˜åŒ–æ„å»ºé…ç½®

```typescript
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, '.', '');
  
  return {
    // å¼€å‘ç¯å¢ƒé…ç½®
    server: mode === 'development' ? {
      port: 3111,
      host: '0.0.0.0',
      allowedHosts: [
        'localhost',
        '127.0.0.1',
        'audiogen.2068.online'
      ],
      proxy: {
        '/api/tts': {
          target: 'https://tts.2068.online',
          changeOrigin: true,
          secure: false,
        },
        '/api/whisper': {
          target: 'https://Whisper.2068.online',
          changeOrigin: true,
          secure: false,
        }
      }
    } : undefined,
    
    // ç”Ÿäº§ç¯å¢ƒåŸºç¡€è·¯å¾„
    base: mode === 'production' ? '/' : '/',
    
    plugins: [react()],
    
    // ç¯å¢ƒå˜é‡æ³¨å…¥
    define: {
      'process.env.API_KEY': JSON.stringify(env.GEMINI_API_KEY),
      'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY),
      'process.env.NODE_ENV': JSON.stringify(mode)
    },
    
    resolve: {
      alias: {
        '@': path.resolve(__dirname, '.'),
      }
    },
    
    // æ„å»ºä¼˜åŒ–
    build: {
      outDir: 'dist',
      sourcemap: false,
      minify: 'terser',
      rollupOptions: {
        output: {
          manualChunks: {
            vendor: ['react', 'react-dom'],
          }
        }
      }
    }
  };
});
```

---

### 6ï¸âƒ£ ä¿®æ”¹ `package.json` - æ·»åŠ  Vercel ç›¸å…³è„šæœ¬

```json
{
  "name": "gemini-neural-tts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "vercel-build": "npm run build"
  },
  "dependencies": {
    "react": "^19.2.3",
    "@google/genai": "^1.35.0",
    "lucide-react": "^0.562.0",
    "react-dom": "^19.2.3"
  },
  "devDependencies": {
    "@types/node": "^22.14.0",
    "@vitejs/plugin-react": "^5.0.0",
    "typescript": "~5.8.2",
    "vite": "^6.2.0"
  }
}
```

---

### 7ï¸âƒ£ åˆ›å»º `.vercelignore` - å¿½ç•¥ä¸éœ€è¦éƒ¨ç½²çš„æ–‡ä»¶

```
.env.local
node_modules
dist
.git
*.md
.DS_Store
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1: å‡†å¤‡ä»£ç 

1. åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºä¸Šè¿°æ‰€æœ‰æ–‡ä»¶
2. ç¡®ä¿ `services/ttsService.ts` å’Œ `services/whisperService.ts` ä¸­çš„ URL ä¿æŒä¸ºç©ºå­—ç¬¦ä¸²(ä½¿ç”¨ç›¸å¯¹è·¯å¾„)

### æ­¥éª¤ 2: æ¨é€åˆ° GitHub

```bash
# åˆå§‹åŒ– Git ä»“åº“(å¦‚æœè¿˜æ²¡æœ‰)
git init

# æ·»åŠ æ‰€æœ‰æ–‡ä»¶
git add .

# æäº¤
git commit -m "å‡†å¤‡éƒ¨ç½²åˆ° Vercel"

# æ¨é€åˆ° GitHub(å‡è®¾ä½ å·²ç»åˆ›å»ºäº†è¿œç¨‹ä»“åº“)
git remote add origin https://github.com/yourusername/edge-tts-web.git
git branch -M main
git push -u origin main
```

### æ­¥éª¤ 3: åœ¨ Vercel ä¸Šéƒ¨ç½²

1. è®¿é—® [vercel.com](https://vercel.com)
2. ä½¿ç”¨ GitHub è´¦å·ç™»å½•
3. ç‚¹å‡» "New Project"
4. é€‰æ‹©ä½ çš„ `edge-tts-web` ä»“åº“
5. é…ç½®é¡¹ç›®:
   - **Framework Preset**: Vite
   - **Build Command**: `npm run build`
   - **Output Directory**: `dist`
6. æ·»åŠ ç¯å¢ƒå˜é‡:
   - `GEMINI_API_KEY`: ä½ çš„ Gemini API å¯†é’¥
7. ç‚¹å‡» "Deploy"
8. ç­‰å¾…éƒ¨ç½²å®Œæˆ(é€šå¸¸ 1-2 åˆ†é’Ÿ)

### æ­¥éª¤ 4: éªŒè¯éƒ¨ç½²

éƒ¨ç½²å®Œæˆå:
1. Vercel ä¼šæä¾›ä¸€ä¸ª `.vercel.app` åŸŸå
2. è®¿é—®è¯¥åŸŸåæµ‹è¯•åº”ç”¨
3. æ£€æŸ¥:
   - TTS è¯­éŸ³ç”Ÿæˆæ˜¯å¦æ­£å¸¸
   - Whisper è¯­éŸ³è½¬æ–‡å­—æ˜¯å¦æ­£å¸¸
   - æœåŠ¡çŠ¶æ€æŒ‡ç¤ºå™¨æ˜¯å¦æ˜¾ç¤ºç»¿è‰²

---

## ğŸ”§ å·¥ä½œåŸç†

### å¼€å‘ç¯å¢ƒ(vite.config.ts çš„ä»£ç†):
```
å‰ç«¯ â†’ Vite Dev Server (localhost:3111) â†’ /api/tts/* â†’ https://tts.2068.online/api/tts/*
```

### ç”Ÿäº§ç¯å¢ƒ(Vercel Functions):
```
å‰ç«¯ â†’ Vercel CDN â†’ /api/tts/* â†’ Vercel Function (tts-proxy) â†’ https://tts.2068.online/api/tts/*
```

---

## ğŸ¯ ä¼˜åŠ¿

1. **CORS é—®é¢˜å®Œå…¨è§£å†³**: Vercel Functions åœ¨æœåŠ¡å™¨ç«¯è½¬å‘è¯·æ±‚,æµè§ˆå™¨ä¸ç›´æ¥è®¿é—®å¤–éƒ¨ API
2. **å¼€å‘ä½“éªŒä¿æŒä¸€è‡´**: æœ¬åœ°å¼€å‘ä»ç„¶ä½¿ç”¨ Vite ä»£ç†,æ— éœ€ä¿®æ”¹ä»£ç 
3. **å…¨çƒåŠ é€Ÿ**: Vercel çš„å…¨çƒ CDN è‡ªåŠ¨ä¼˜åŒ–å†…å®¹åˆ†å‘
4. **è‡ªåŠ¨ HTTPS**: Vercel è‡ªåŠ¨æä¾› SSL è¯ä¹¦
5. **é›¶æˆæœ¬**: Vercel å…è´¹å¥—é¤è¶³å¤Ÿä½¿ç”¨
6. **æ˜“äºç»´æŠ¤**: æ‰€æœ‰é…ç½®éƒ½åœ¨é¡¹ç›®ä¸­,ç‰ˆæœ¬æ§åˆ¶å‹å¥½

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å‡½æ•°è¶…æ—¶**: Vercel Functions å…è´¹ç‰ˆæœ‰ 10 ç§’è¶…æ—¶é™åˆ¶,å¦‚æœéŸ³é¢‘ç”Ÿæˆå¾ˆæ…¢å¯èƒ½éœ€è¦å‡çº§åˆ° Pro ç‰ˆ
2. **æ–‡ä»¶å¤§å°é™åˆ¶**: å‡½æ•°ä½“å¤§å°é™åˆ¶ä¸º 50MB,æœ¬é¡¹ç›®ä¸ä¼šæœ‰é—®é¢˜
3. **ç¯å¢ƒå˜é‡**: ç¡®ä¿åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­æ­£ç¡®é…ç½® `GEMINI_API_KEY`
4. **API æœåŠ¡å¯ç”¨æ€§**: ç¡®ä¿è¿œç¨‹ TTS å’Œ Whisper æœåŠ¡æ”¯æŒ CORS,æˆ–è€…é€šè¿‡ Vercel Functions ä»£ç†è®¿é—®

---

## ğŸ“ æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆé€šè¿‡ Vercel Serverless Functions åˆ›å»ºäº†ä¸€ä¸ªé€æ˜çš„ API ä»£ç†å±‚,å®Œç¾è§£å†³äº†:
- âœ… CORS è·¨åŸŸé—®é¢˜
- âœ… API å¯†é’¥å®‰å…¨
- âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®
- âœ… å…¨çƒåŠ é€Ÿè®¿é—®

ä½ ç°åœ¨å¯ä»¥åˆ‡æ¢åˆ° **CRAFT æ¨¡å¼**,æˆ‘å¯ä»¥å¸®ä½ åˆ›å»ºæ‰€æœ‰éœ€è¦çš„é…ç½®æ–‡ä»¶ã€‚æˆ–è€…ä½ å¸Œæœ›æˆ‘æä¾›æ›´å¤šçš„ç»†èŠ‚è¯´æ˜? ğŸš€